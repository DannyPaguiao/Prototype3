<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Bejewler</title>
		<script src="js/jquery.js"></script>
		<script src="js/underscore.js"></script>
		<script src="js/three.js"></script>
        <script src="js/EffectComposer.js"></script>
        <script src="js/RenderPass.js"></script>
        <script src="js/ShaderPass.js"></script>
        <script src="js/MaskPass.js"></script>
        <script src="js/CopyShader.js"></script>
        <script src="js/Gems.js"></script>
        <script src="js/Robot.js"></script>
        <script src="js/Game.js"></script>
        <script src="js/Panes.js"></script>
       
       
        <!-- load fonts -->
        <script src="fonts/gentilis_bold.typeface.js"></script>
        <script src="fonts/gentilis_regular.typeface.js"></script>
        <script src="fonts/optimer_bold.typeface.js"></script>
        <script src="fonts/optimer_regular.typeface.js"></script>
        <script src="fonts/helvetiker_bold.typeface.js"></script>
        <script src="fonts/helvetiker_regular.typeface.js"></script>
        <script src="fonts/droid_sans_regular.typeface.js"></script>
        <script src="fonts/droid_sans_bold.typeface.js"></script>
        <script src="fonts/droid_serif_regular.typeface.js"></script>
        <script src="fonts/droid_serif_bold.typeface.js"></script>
        <!-- load glsl files -->
        <script src="shaders/perlin.glsl"></script>
        
	</head>
	<body>
		<p>
        Bejewler
		</p>
        <p> W - Move up a Space
        	A - Move Left a Space
        	S - Move Down a Space
        	D - Move Right a Space</p>
        	<p>
        	L Arrow Key - face left
        	U Arrow Key - face Up
        	R Arrow Key - face right
        	D Arrow Key - face down
        	Spacebar - Shoot gem
        	</p>
        	<p>
        	Get to the GOAL GEM! Before time expires 
        	Match Gems to clear paths
        	</p>
        <div id='gameArea' />
        
        <p id="timer"></p>
        
        <script>
        var Ticker;
        var timeLeft;
        var totalTime;
        var time;
        var prevTime;
        var score;
        var scoreNext
        var scoreKeeper;

		function checkTime() {
			if (time != prevTime) {
				prevTime = time;
				return true;
			}
			else {
				return false;
			}
		}
            
        function setTime(amountOfTime){
            timeLeft = amountOfTime;
            totalTime = timeLeft;
            prevTime = time;
            Ticker = setInterval(function() {tick()}, 1000);
        }
            
        function tick(){
            id = document.getElementById("timer");
            timeLeft--;
            time = timeLeft;
        }
            </script>
        
     
        
        <script id='wood-vertex-shader' type='x-shader/x-vertex'>
            varying vec3 vNormal;
            varying vec3 vPosition;
            
            void main() {
                // Surface normal (view space)
                vNormal = normalMatrix * vec3(normal);
                // Position (model space)
                vPosition = position;
                gl_Position = projectionMatrix *
                modelViewMatrix *
                vec4(position, 1.0);
            }
            </script>
        
        <script id='wood-fragment-shader' type='x-shader/x-fragment'>
            varying vec3 vNormal;
            uniform float uTime;
            varying vec3 vPosition;
            varying vec3 vView;
            
            float wood(vec3 p) {
                float noise = 4.0 * cnoise(p * vec3(0.1, 0.005, 0.02));
                return sin(0.3 * length(p.xz) + noise);
            }
            
            void main() {
                float noise = wood(vPosition);
                vec4 woodDark = vec4((150.0 / 255.0), (111.0 / 255.0), 51.0/255.0, 1.0);
                vec4 woodLight = vec4(249.0 / 255.0, 195.0 / 255.0, 150.0/255.0, 1.0);
                vec4 noiseColor = noise * woodDark + (1.0 - noise) * woodLight;
                gl_FragColor = vec4(noiseColor.rgb, 1.0);
            }
            </script>
            
            <script id='goal-vertex-shader' type='x-shader/x-vertex'>
			varying vec3 vNormal;
			varying vec3 vPosition;
			
			void main() {
			  vNormal = normalMatrix * vec3(normal);
			  vPosition = position;
			  gl_Position = projectionMatrix *
			                modelViewMatrix *
			                vec4(position, 1.0);
			}
			</script>
			
			<script id='goal-fragment-shader' type='x-shader/x-fragment'>
			varying vec3 vNormal;
			uniform float uTime;
			varying vec3 vPosition;
			
			void main() {
			  vec3 nvNormal = normalize(vNormal);
			  gl_FragColor = vec4(cnoise(vPosition * 0.03 + uTime * vec3(1.0, 0.0, 0.0)), 0.0, 0.0, 1.0);
			}
			</script>
       
        <script id='sphere-vertex-shader' type='x-shader/x-vertex'>
            varying vec3 vNormal;
            
            void main() {
                // Calculate normal in view space
                vNormal = normalMatrix * vec3(normal);
                gl_Position = projectionMatrix *
                modelViewMatrix *
                vec4(position, 1.0);
            }
            </script>
        
        <script id='sphere-fragment-shader' type='x-shader/x-fragment'>
            varying vec3 vNormal;
            
            vec4 transform(float u) {
                if (u > 0.95)
                return vec4(0.5,1.0,0.5,1.0);
                else if (u > 0.5)
                return vec4(0.3,0.8,0.3,1.0);
                else if (u > 0.25)
                return vec4(0.2,0.4,0.2,1.0);
                else
                return vec4(0.1,0.2,0.1,1.0);
            }
            void main() {
                vec3 light = vec3(0.7, 0.7, 1.0);
                // normalize light vector
                light = normalize(light);
                float prod = max(0.0, dot(normalize(vNormal), light));
                gl_FragColor = transform(prod);
            }
            </script>
        
        <script id='iso-vertex-shader' type='x-shader/x-vertex'>
            varying vec3 vNormal;
            
            void main() {
                // Calculate normal in view space
                vNormal = normalMatrix * vec3(normal);
                gl_Position = projectionMatrix *
                modelViewMatrix *
                vec4(position, 1.0);
            }
            </script>
        
        <script id='iso-fragment-shader' type='x-shader/x-fragment'>
            varying vec3 vNormal;
            
            vec4 transform(float u) {
                if (u > 0.95)
                return vec4(0.5,0.5,1.0,1.0);
                else if (u > 0.5)
                return vec4(0.3,0.3,0.8,1.0);
                else if (u > 0.25)
                return vec4(0.2,0.2,0.4,1.0);
                else
                return vec4(0.1,0.1,0.2,1.0);
            }
            void main() {
                vec3 light = vec3(0.7, 0.7, 1.0);
                // normalize light vector
                light = normalize(light);
                float prod = max(0.0, dot(normalize(vNormal), light));
                gl_FragColor = transform(prod);
            }
            </script>
        
        <script id='diamond-vertex-shader' type='x-shader/x-vertex'>
            varying vec3 vNormal;
            
            void main() {
                // Calculate normal in view space
                vNormal = normalMatrix * vec3(normal);
                gl_Position = projectionMatrix *
                modelViewMatrix *
                vec4(position, 1.0);
            }
            </script>
        
        <script id='diamond-fragment-shader' type='x-shader/x-fragment'>
            varying vec3 vNormal;
            
            vec4 transform(float u) {
                if (u > 0.95)
                return vec4(1.0,1.0,0.5,1.0);
                else if (u > 0.5)
                return vec4(0.8,0.8,0.3,1.0);
                else if (u > 0.25)
                return vec4(0.4,0.4,0.2,1.0);
                else
                return vec4(0.2,0.2,0.1,1.0);
            }
            void main() {
                vec3 light = vec3(0.7, 0.7, 1.0);
                // normalize light vector
                light = normalize(light);
                float prod = max(0.0, dot(normalize(vNormal), light));
                gl_FragColor = transform(prod);
            }
            </script>
            
        <script id='cube-vertex-shader' type='x-shader/x-vertex'>
            varying vec3 vNormal;
            
            void main() {
                // Calculate normal in view space
                vNormal = normalMatrix * vec3(normal);
                gl_Position = projectionMatrix *
                modelViewMatrix *
                vec4(position, 1.0);
            }
            </script>
        
        <script id='cube-fragment-shader' type='x-shader/x-fragment'>
            varying vec3 vNormal;
            
            vec4 transform(float u) {
                if (u > 0.95)
                return vec4(1.0,0.6,1.0,1.0);
                else if (u > 0.5)
                return vec4(0.9,0.4,0.9,1.0);
                else if (u > 0.1)
                return vec4(0.7,0.3,0.7,1.0);
                else
                return vec4(0.5,0.2,0.5,1.0);
            }
            
            void main() {
                vec3 light = vec3(0.7, 0.7, 1.0);
                // normalize light vector
                light = normalize(light);
                float prod = max(0.0, dot(normalize(vNormal), light));
                gl_FragColor = transform(prod);
            }
            </script>

		<script>

			$(function() {
              
              var game = new Game();
              game.init();
              //game.pushPane(new MenuPane());
              game.start();
              
              });
            
        </script>
        
	</body>
</html>