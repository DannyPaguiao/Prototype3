<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Bejewler</title>
		<script src="js/jquery.js"></script>
		<script src="js/underscore.js"></script>
		<script src="js/three.js"></script>
        <script src="js/EffectComposer.js"></script>
        <script src="js/RenderPass.js"></script>
        <script src="js/ShaderPass.js"></script>
        <script src="js/MaskPass.js"></script>
        <script src="js/CopyShader.js"></script>
        <script src="js/Gems.js"></script>
        <script src="js/Robot.js"></script>
        <script src="js/Game.js"></script>
        <script src="js/Panes.js"></script>
        <!-- load fonts -->
        <script src="fonts/gentilis_bold.typeface.js"></script>
        <script src="fonts/gentilis_regular.typeface.js"></script>
        <script src="fonts/optimer_bold.typeface.js"></script>
        <script src="fonts/optimer_regular.typeface.js"></script>
        <script src="fonts/helvetiker_bold.typeface.js"></script>
        <script src="fonts/helvetiker_regular.typeface.js"></script>
        <script src="fonts/droid_sans_regular.typeface.js"></script>
        <script src="fonts/droid_sans_bold.typeface.js"></script>
        <script src="fonts/droid_serif_regular.typeface.js"></script>
        <script src="fonts/droid_serif_bold.typeface.js"></script>
        
	</head>
	<body>
		<p>
        Bejewler
		</p>
        
        <div id='gameArea' />
        
        <script id='goal-vertex-shader' type='x-shader/x-vertex'>
            varying vec3 vNormal;
            varying vec3 vPosition;
            
            void main() {
                // Surface normal (world space)
                vNormal = (modelMatrix * vec4(normal, 1.0)).xyz;
                // Position (world space)
                vPosition = (modelMatrix * vec4(position, 1.0)).xyz;
                gl_Position = projectionMatrix *
                modelViewMatrix *
                vec4(position, 1.0);
            }
            </script>
        
        <script id='goal-fragment-shader' type='x-shader/x-fragment'>
            uniform samplerCube envMap;
            varying vec3 vNormal;
            varying vec3 vPosition;
            
            void main() {
                vec3 normal = normalize(vNormal);
                vec3 cameraToVertex = normalize(vPosition - cameraPosition);
                vec3 reflectVec = reflect(cameraToVertex, normal);
                gl_FragColor = textureCube(envMap, reflectVec);
            }
            </script>
        
        <script id='sphere-vertex-shader' type='x-shader/x-vertex'>
            varying vec3 vNormal;
            
            void main() {
                // Calculate normal in view space
                vNormal = normalMatrix * vec3(normal);
                gl_Position = projectionMatrix *
                modelViewMatrix *
                vec4(position, 1.0);
            }
            </script>
        
        <script id='sphere-fragment-shader' type='x-shader/x-fragment'>
            varying vec3 vNormal;
            
            vec4 transform(float u) {
                if (u > 0.95)
                return vec4(0.5,1.0,0.5,1.0);
                else if (u > 0.5)
                return vec4(0.3,0.8,0.3,1.0);
                else if (u > 0.25)
                return vec4(0.2,0.4,0.2,1.0);
                else
                return vec4(0.1,0.2,0.1,1.0);
            }
            void main() {
                vec3 light = vec3(0.7, 0.7, 1.0);
                // normalize light vector
                light = normalize(light);
                float prod = max(0.0, dot(normalize(vNormal), light));
                gl_FragColor = transform(prod);
            }
            </script>
        
        <script id='iso-vertex-shader' type='x-shader/x-vertex'>
            varying vec3 vNormal;
            
            void main() {
                // Calculate normal in view space
                vNormal = normalMatrix * vec3(normal);
                gl_Position = projectionMatrix *
                modelViewMatrix *
                vec4(position, 1.0);
            }
            </script>
        
        <script id='iso-fragment-shader' type='x-shader/x-fragment'>
            varying vec3 vNormal;
            
            vec4 transform(float u) {
                if (u > 0.95)
                return vec4(0.5,0.5,1.0,1.0);
                else if (u > 0.5)
                return vec4(0.3,0.3,0.8,1.0);
                else if (u > 0.25)
                return vec4(0.2,0.2,0.4,1.0);
                else
                return vec4(0.1,0.1,0.2,1.0);
            }
            void main() {
                vec3 light = vec3(0.7, 0.7, 1.0);
                // normalize light vector
                light = normalize(light);
                float prod = max(0.0, dot(normalize(vNormal), light));
                gl_FragColor = transform(prod);
            }
            </script>
        
        <script id='diamond-vertex-shader' type='x-shader/x-vertex'>
            varying vec3 vNormal;
            
            void main() {
                // Calculate normal in view space
                vNormal = normalMatrix * vec3(normal);
                gl_Position = projectionMatrix *
                modelViewMatrix *
                vec4(position, 1.0);
            }
            </script>
        
        <script id='diamond-fragment-shader' type='x-shader/x-fragment'>
            varying vec3 vNormal;
            
            vec4 transform(float u) {
                if (u > 0.95)
                return vec4(1.0,1.0,0.5,1.0);
                else if (u > 0.5)
                return vec4(0.8,0.8,0.3,1.0);
                else if (u > 0.25)
                return vec4(0.4,0.4,0.2,1.0);
                else
                return vec4(0.2,0.2,0.1,1.0);
            }
            void main() {
                vec3 light = vec3(0.7, 0.7, 1.0);
                // normalize light vector
                light = normalize(light);
                float prod = max(0.0, dot(normalize(vNormal), light));
                gl_FragColor = transform(prod);
            }
            </script>
            
        <script id='cube-vertex-shader' type='x-shader/x-vertex'>
            varying vec3 vNormal;
            
            void main() {
                // Calculate normal in view space
                vNormal = normalMatrix * vec3(normal);
                gl_Position = projectionMatrix *
                modelViewMatrix *
                vec4(position, 1.0);
            }
            </script>
        
        <script id='cube-fragment-shader' type='x-shader/x-fragment'>
            varying vec3 vNormal;
            
            vec4 transform(float u) {
                if (u > 0.95)
                return vec4(1.0,0.6,1.0,1.0);
                else if (u > 0.5)
                return vec4(0.9,0.4,0.9,1.0);
                else if (u > 0.1)
                return vec4(0.7,0.3,0.7,1.0);
                else
                return vec4(0.5,0.2,0.5,1.0);
            }
            
            void main() {
                vec3 light = vec3(0.7, 0.7, 1.0);
                // normalize light vector
                light = normalize(light);
                float prod = max(0.0, dot(normalize(vNormal), light));
                gl_FragColor = transform(prod);
            }
            </script>

		<script>

			$(function() {
              
              var game = new Game();
              game.init();
              //game.pushPane(new MenuPane());
              game.start();
              
              });
            
        </script>
        
        <!---Implement directions from GMaps API---------->
        <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
        <style type="text/css">
            html { height: 100%; }
            body { height: 100%; margin: -50; padding: 50 }
            #map-canvas { height: 50%; width: 50%}
            </style>
        <script type="text/javascript"
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC9r1YcV7JvWDI13pROQIL7qTTXEl8WqSY&sensor=true">
            </script>
        <script type="text/javascript">
            
            function initialize() {
                var map;
                directionsDisplay = new google.maps.DirectionsRenderer();
                var mapOptions = {
                    zoom: 18,
                    mapTypeId: google.maps.MapTypeId.SATELLITE
                };
                map = new google.maps.Map(document.getElementById('map-canvas'),
                                          mapOptions);
                
                directionsDisplay.setMap(map);
                
                // Try HTML5 geolocation
                if(navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function(position) {
                                                             var pos = new google.maps.LatLng(position.coords.latitude,
                                                                                              position.coords.longitude);
                                                             
                                                             
                                                             map.setCenter(pos);
                                                             }, function() {
                                                             handleNoGeolocation(true);
                                                             });
                } else {
                    // Browser doesn't support Geolocation
                    handleNoGeolocation(false);
                }
            }
            
            function handleNoGeolocation(errorFlag) {
                if (errorFlag) {
                    var content = 'Error: The Geolocation service failed.';
                } else {
                    var content = 'Error: Your browser doesn\'t support geolocation.';
                }
                
                var options = {
                    map: map,
                    position: new google.maps.LatLng(80, 105),
                    content: content
                };
                
                var infowindow = new google.maps.InfoWindow(options);
                map.setCenter(options.position);
            }
            
            google.maps.event.addDomListener(window, 'load', initialize);
            var directionsDisplay;
            var directionsService = new google.maps.DirectionsService();
            
            function calcRoute() {
                var start = document.getElementById('start').value;
                var end = document.getElementById('end').value;
                var request = {
                    origin:start,
                    destination:end,
                    travelMode: google.maps.DirectionsTravelMode.WALKING
                };
                directionsService.route(request, function(response, status) {
                                        if (status == google.maps.DirectionsStatus.OK) {
                                        directionsDisplay.setDirections(response);
                                        }
                                        });
            }
            
            google.maps.event.addDomListener(window, 'load', initialize);
            </script>
        
        <div id="panel">
            <b>Start: </b>
            <select id="start" onchange="calcRoute();">
                <option value="santa cruz, ca">Santa Cruz</option>
                <option value="escondido, ca">Escondido</option>
            </select>
            <b>End: </b>
            <select id="end" onchange="calcRoute();">
                <option value="aptos, ca">Aptos</option>
                <option value="san francisco, ca">San Francisco</option>
            </select>
        </div>
        <div id="map-canvas"></div>
	</body>
</html>