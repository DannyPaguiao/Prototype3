
<!DOCTYPE html>
<html lang="en">
<head>
<title>Bejewler</title>
  <script src="jquery.js"></script>
  <script src="underscore.js"></script>
  <script src="three.min.js"></script>
    
</head>
<body>

<br/ >
<font size="6">Bejeweler</font>
<p>
    
<script>

var board_to_world = function(position) {
  // Convert board position into world position
  return {x: 100 * position.x, y: 100 * position.y, z:0};
};

var barrier_to_world = function(position) {
  // Convert barrier position into world position
  return {x: 100 * position.x, y: 100 * position.y, z:0};
};
    
var goal_to_world = function(position) {
  // Convert goal position into world position
    return {x: 100 * position.x, y: 100 * position.y, z:0};
};

var Barrier = function(position) {
  //// A Barrier is a game object
  // Default position if unspecified is at square 0, 0
  this.isEmpty = false;
  this.boardPosition = position || {x: 0, y: 0};
  this.type = 'barrier';
  this.geometry = new THREE.CubeGeometry(90, 90, 90);
  // Geometry should always be around origin
  this.material = new THREE.MeshLambertMaterial({color: 0xff0000});
  this.object = new THREE.Mesh(this.geometry, this.material);
  // A mesh is an Object3D, change its position to move
  this.object.position = board_to_world(this.boardPosition);  
};

var Goal = function(position) {
    // The goal is a game object
    this.boardPosition = position || {x: 0, y: 0};
    this.type = 'goal';
    this.geometry = new THREE.SphereGeometry(70, 70, 70);
    // Geometry should always be around origin
    this.material = new THREE.MeshPhongMaterial({color: 0xFE9C46});
    this.object = new THREE.Mesh(this.geometry, this.material);
    // A mesh is an Object 3D, change its position to move
    this.object.position - board_to_world(this.boardPosition);
};
    
Goal.prototype.moveTo = function(position) {
    this.boardPosition = position;
    this.updateBoardPosition();
};
    
Goal.prototype.updateBoardPosition = function() {
    this.object.position = goal_to_world(this.boardPosition);
};

Barrier.prototype.moveTo = function(position) {
  this.boardPosition = position;
  this.updateBoardPosition();
};

Barrier.prototype.updateBoardPosition = function() {
  this.object.position = barrier_to_world(this.boardPosition);
};

var Robot = function(position) {
  //// A Robot is a game object
  // Default position if unspecified is at square 0, 0
  this.boardPosition = position || {x: 0, y: 0};
  this.type = 'robot';
  this.geometry = new THREE.SphereGeometry(45, 20, 20);
  // Geometry should always be around origin
  // Make it blue
  this.material = new THREE.MeshPhongMaterial({color: 0x0000ff});
  this.object = new THREE.Mesh(this.geometry, this.material);
  
  // A mesh is an Object3D, change its position to move
  this.object.position = board_to_world(this.boardPosition);
  
};

Robot.prototype.updateBoardPosition = function() {
  this.object.position = board_to_world(this.boardPosition);
};

Robot.prototype.moveTo = function(position) {
  this.boardPosition = position;
  this.updateBoardPosition();
};
                                                    
var Game = function() {
  // A Game object is the highest level object representing entire game
};

Game.prototype.init = function() {
  var that = this;
 
  this.virtualBoard = new Array(7);
  for(var i = 0; i < 7; i++){
    this.virtualBoard[i] = new Array(7);
    
  }
  
  this.startingBoard = [[false, false, true, false, false, false, false],							// create a board where true = occupied by a block
                        [false, false, false, false, false, true, false],							// and where false = empty spot
                        [false, false, true, true, true, true, false],							// Y is horizontal
                        [false, false, true, false, false, false, false],							// X is vertical
                        [false, false, true, true, true, true, false],
                        [false, false, false, false, false, true, false],
                        [false, false, false, false, false, false, false]];
                        
  
  
  for(var x = 0; x < 7; x++){
    for(var y = 0; y < 7; y++){
        
        this.virtualBoard[y][x] = new Barrier({x: x-3, y: y - 3});
        if(!this.startingBoard[x][y]){
            this.virtualBoard[y][x].isEmpty = true;
        }
        
    }
  }

  this.robot = new Robot({x: -2, y: -3});																		// create a new robot
  this.goal = new Goal({x: 8, y: 7});

  this.camera = new THREE.PerspectiveCamera(75, 4.0/3.0, 1, 10000);
  this.camera.position.z = 550;

  this.scene = new THREE.Scene();

for(var x = 0 ; x < 7; x++){
    for(var y = 0; y < 7; y++){
        if(this.startingBoard[x][y]){																			// goes through premade grid and adds a barrier
                                                                                                                // for everywhere we specified as "true"
        that.scene.add(this.virtualBoard[x][y].object);
        }
    }
  }
  
  this.scene.add(this.robot.object);															// add robot to scene
  this.scene.add(this.goal.object);                                                             // Add goal to the scene
                                                        

  // Spotlight
  var spotlight = new THREE.PointLight(0xffffff, 1, 1000);
  spotlight.position.set(0, -100, 400);
  this.scene.add(spotlight);
  // Ambient light
  var ambient_light = new THREE.AmbientLight(0x202020);
  this.scene.add(ambient_light);
  // Background plane
  var bgplane = new THREE.Mesh(new THREE.PlaneGeometry(800, 700),
    new THREE.MeshLambertMaterial());
  bgplane.translateZ(-100);
  this.scene.add(bgplane);
  
  this.renderer = new THREE.WebGLRenderer({antialias: true});
  this.renderer.setSize(800, 600);
  this.renderer.setClearColor(0xeeeeee, 1.0);
  document.body.appendChild(this.renderer.domElement);
  
  // Setup keyboard events
  this.keys = {};
  $('body').keydown(function(e) {															   
    if (e.which) {
      if (that.keys[e.which] !== 'triggered') {
        that.keys[e.which] = true;
      }
    }															   
  });
  $('body').keyup(function(e) {															
    if (e.which) {
      that.keys[e.which] = false;
    }															   
  });
};

Game.prototype.render = function(t) {
  // Bob the camera a bit
  this.camera.position.x = 0;
  this.camera.position.y = -300;
  this.camera.lookAt(this.scene.position);
  this.renderer.render(this.scene, this.camera);
};

Game.prototype.legalRobotMove = function(position) {
  if (position.x < -3 || position.x > 3) {							// check if position that you want to move to is the edge of the board horizontally
    return false;
  }
  if (position.y < -3 || position.y > 3) {							// check if position that you want to move to is the edge of the board vertically
    return false;
  }
  if(this.virtualBoard[position.x + 3][position.y + 3].isEmpty){
    return true;
  } 
  else{																// whereas if it is the robot it will get blocked if it tries to go to a position with a barrier
    return false;
  }
    return true;
};


Game.prototype.handleInput = function() {
    
  // Left
  if (this.keys[65] === true) {
    this.keys[65] = 'triggered';
    var newPosition = {x: this.robot.boardPosition.x - 1,
      y: this.robot.boardPosition.y};
  
    if (this.legalRobotMove(newPosition)) {
      this.robot.moveTo(newPosition);								// check neighbors if there's a block
    }
  }
  // Right
  if (this.keys[68] === true) {
    this.keys[68] = 'triggered';
    var newPosition = {x: this.robot.boardPosition.x + 1,
      y: this.robot.boardPosition.y};
    if (this.legalRobotMove(newPosition)) {
      this.robot.moveTo(newPosition);								
    }
  }
  // Up
  if (this.keys[87] === true) {
    this.keys[87] = 'triggered';
    var newPosition = {x: this.robot.boardPosition.x,
      y: this.robot.boardPosition.y + 1};
    if (this.legalRobotMove(newPosition)) {
      this.robot.moveTo(newPosition);
    }
  }
  // Down
  if (this.keys[83] === true) {
    this.keys[83] = 'triggered';
    var newPosition = {x: this.robot.boardPosition.x,
      y: this.robot.boardPosition.y - 1};
    if (this.legalRobotMove(newPosition)) {
      this.robot.moveTo(newPosition);
    }
  }
};

Game.prototype.start = function() {
  var that = this;
  var time0 = new Date().getTime(); // milliseconds since 1970
  var loop = function() {
    var time = new Date().getTime();
    // Render visual frame
    that.render(time - time0);
    // Respond to user input
    that.handleInput();
    // Loop
    requestAnimationFrame(loop, that.renderer.domElement);
  };
  loop();  
};

//// 

$(function() {
  
  var game = new Game();
  game.init();
  game.start();

});

</script>
    
    <!---Implement directions from GMaps API---------->
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
        html { height: 100% }
        body { height: 100%; margin: 0; padding: 0 }
        #map-canvas { height: 50%; width: 40%}
        </style>
    <script type="text/javascript"
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC9r1YcV7JvWDI13pROQIL7qTTXEl8WqSY&sensor=true">
        </script>
    <script type="text/javascript">
        google.maps.event.addDomListener(window, 'load', initialize);
        var map;
        
        function initialize() {
            directionsDisplay = new google.maps.DirectionsRenderer();
            var mapOptions = {
                zoom: 18,
                mapTypeId: google.maps.MapTypeId.SATELLITE
            };
            map = new google.maps.Map(document.getElementById('map-canvas'),
                                      mapOptions);
            
            directionsDisplay.setMap(map);
            
            // Try HTML5 geolocation
            if(navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                     var pos = new google.maps.LatLng(position.coords.latitude,
                                                      position.coords.longitude);
                     
                     
                     map.setCenter(pos);
                     }, function() {
                     handleNoGeolocation(true);
                     });
            } else {
                // Browser doesn't support Geolocation
                handleNoGeolocation(false);
            }
        }
        
        function handleNoGeolocation(errorFlag) {
            if (errorFlag) {
                var content = 'Error: The Geolocation service failed.';
            } else {
                var content = 'Error: Your browser doesn\'t support geolocation.';
            }
            
            var options = {
                map: map,
                position: new google.maps.LatLng(60, 105),
                content: content
            };
            
            var infowindow = new google.maps.InfoWindow(options);
            map.setCenter(options.position);
        }
        
        google.maps.event.addDomListener(window, 'load', initialize);
        var directionsDisplay;
        var directionsService = new google.maps.DirectionsService();
        
        function calcRoute() {
            var start = document.getElementById('start').value;
            var end = document.getElementById('end').value;
            var request = {
                origin:start,
                destination:end,
                travelMode: google.maps.DirectionsTravelMode.WALKING
            };
            directionsService.route(request, function(response, status) {
                                    if (status == google.maps.DirectionsStatus.OK) {
                                    directionsDisplay.setDirections(response);
                                    }
                                    });
        }
        
        google.maps.event.addDomListener(window, 'load', initialize);
        </script>

    <div id="panel">
        <b>Start: </b>
        <select id="start" onchange="calcRoute();">
            <option value="santa cruz, ca">Santa Cruz</option>
            <option value="escondido, ca">Escondido</option>
        </select>
        <b>End: </b>
        <select id="end" onchange="calcRoute();">
            <option value="aptos, ca">Aptos</option>
            <option value="san francisco, ca">San Francisco</option>
        </select>
    </div>
    <div id="map-canvas"></div>
</body>
</html>

